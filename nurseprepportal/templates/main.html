<!doctype html>
{% load static %}
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>NursingPrepPortal | Dashboard</title>
    <!--begin::Accessibility Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <!--end::Accessibility Meta Tags-->
    <!--begin::Primary Meta Tags-->
    <meta name="title" content="AdminLTE v4 | Dashboard" />
    <meta name="author" content="ColorlibHQ" />
  
    <!--end::Primary Meta Tags-->
    <!--begin::Accessibility Features-->
    <!-- Skip links will be dynamically added by accessibility.js -->
    <meta name="supported-color-schemes" content="light dark" />
    <link rel="preload" href="{% static 'assets/css/adminlte.css' %}" as="style" />
    <!--end::Accessibility Features-->
    <!--begin::Fonts-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
      media="print"
      onload="this.media='all'"
    />
    <!--end::Fonts-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->
    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->
    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="{% static 'assets/css/adminlte.css' %}" />
    <!--end::Required Plugin(AdminLTE)-->
    
   
      <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

  </head>
  <!--end::Head-->
  <!--begin::Body--> 
  <body class="layout-fixed sidebar-expand-lg sidebar-collapse bg-body-tertiary">

    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <!--begin::Header-->
    
   {% include 'base/header_nav_component.html' %}
      <!--begin::App Main-->
      <main class="app-main">
        <!--begin::App Content Header-->

       
      
        <div class="app-content-header">
          <!--begin::Container-->

                      
         {% if messages %}
          <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
            {% for message in messages %}
              <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                  <strong class="me-auto">Notification</strong>
                  <small class="text-muted">just now</small>
                  <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body {% if message.tags %}{{ message.tags }}{% endif %}">
                  {{ message }}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

    {% block content %}
        
        {% endblock %}

      </main>
      <!--end::App Main-->
      <!--begin::Footer-->
      <footer class="app-footer">
        <!--begin::To the end-->
        <div class="float-end d-none d-sm-inline">Anything you want</div>
        <!--end::To the end-->
        <!--begin::Copyright-->
        <strong>
          Copyright &copy; 2014-2025&nbsp;
          <a href="https://chrislanduniversity.edu.ng" class="text-decoration-none">ICT Product</a>.
        </strong>
        All rights reserved.
        <!--end::Copyright-->
      </footer>
      <!--end::Footer-->
    </div>
    <!--end::App Wrapper-->
    <!--begin::Script-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="{% static 'assets/js/adminlte.js' %}"></script>
    <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
      const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
      };
      document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
        if (sidebarWrapper && OverlayScrollbarsGlobal?.OverlayScrollbars !== undefined) {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>
    <!--end::OverlayScrollbars Configure-->
    <!-- OPTIONAL SCRIPTS -->
    <!-- sortablejs -->
    <script
      src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"
      crossorigin="anonymous"
    ></script>
    <!-- sortablejs -->
    <script>
      new Sortable(document.querySelector('.connectedSortable'), {
        group: 'shared',
        handle: '.card-header',
      });

      const cardHeaders = document.querySelectorAll('.connectedSortable .card-header');
      cardHeaders.forEach((cardHeader) => {
        cardHeader.style.cursor = 'move';
      });
    </script>



    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.bundle.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="{% static 'assets/js/script.js' %}"> </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
 

   <script>
  document.addEventListener('DOMContentLoaded', function () {
    const stationSelect = document.getElementById('stationSelect');
    const candidateSelect = document.querySelector('select[name="matric_number"]');
    const searchInput = document.getElementById('searchInput');
    const display = document.getElementById('matricDisplay');
    const totalScoreSpan = document.getElementById('totalScore');

    function updateTotal() {
      let total = 0;

      document.querySelectorAll('.score-select').forEach(select => {
        // console.dir(select)
        const val = parseFloat(select.value);
        if (!isNaN(val)) total += val;
      });
      document.getElementById('totalScore').textContent = total.toFixed(2);
      // if (totalScoreSpan) totalScoreSpan.textContent = total.toFixed(2);
    }

    function attachScoreListeners() {
      document.querySelectorAll('.score-select').forEach(select => {
        select.addEventListener('change', updateTotal);
      });
      updateTotal();
    }

    function fetchActivities() {
      const stationId = stationSelect.value;
      const matricNumber = candidateSelect.value;

      fetch(`/ajax/get_activities/?station_id=${stationId}&matric_number=${matricNumber}`)
        .then(response => response.json())
        .then(data => {
          document.getElementById('activities-container').innerHTML = data.activities_html;
          document.getElementById('candidate-info-container').innerHTML = data.candidate_info_html;
          attachScoreListeners(); // Re-attach after DOM update
        });
    }
    



    // Event listeners
        stationSelect.addEventListener('change', () => {
          fetchActivities().then(() => {
              attachScoreListeners();
          });
      });

      candidateSelect.addEventListener('change', () => {
          fetchActivities().then(() => {
              attachScoreListeners();
          });


      });


    if (searchInput && candidateSelect) {
      searchInput.addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase();
        Array.from(candidateSelect.options).forEach(option => {
          option.style.display = option.text.toLowerCase().includes(searchTerm) ? 'block' : 'none';
        });
      });

      candidateSelect.addEventListener('change', function () {
        if (display) display.textContent = `Matric Number: ${this.value}`;
      });


      
    }

    // Initial setup
    attachScoreListeners();
  });
</script>

<!-- Toast Script (kept separate for clarity) -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toastEl = document.getElementById('liveToast');
    if (toastEl && toastEl.querySelector('.toast-body').textContent.trim() !== '') {
      new bootstrap.Toast(toastEl).show();
    }
  });
</script>


  </body>
  <!--end::Body-->
</html>
